<!DOCTYPE HTML>
<html>
  <head>
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css" />
	<script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
<!--
	//This needs to be commentd out for some reason
	<script src="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.js"></script>
-->
        <script type="text/javascript" src="js/sb.js"></script>
        <script type="text/javascript" src="js/tele.button.js"></script>
        <script type="text/javascript" src="js/tele.slider.js"></script>
        <script type="text/javascript" src="js/tele.joystick.js"></script>
        <script type="text/javascript" src="js/tele.led.js"></script>
    
        <script src="http://www.html5canvastutorials.com/libraries/kinetic-v4.3.0-beta2.js"></script>

    <script type="text/javascript">

        function range(x, in_min, in_max, out_min, out_max)
        {
          return Math.floor((x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min);
        }

    	// when page loads call spacebrew setup function 
		//$(window).on("load", setupSpacebrew);

		// wher the jquery mobile is ready to initialize the UI call the setUI function 
		//$(document).bind("pageinit", setupUI);

		// variable that holds the spacebrew client object
		//var sb;

		// * setupSpacebrew Function that creates and configures the connection to the Spacebrew server.  It is called when the page loads.
		function setupSpacebrew (){
			console.log("Setting up spacebrew connection");
			sb = new Spacebrew.Client(undefined, 
                 		"Spacebrew Sliders",
				"Sliders for sending and displaying SpaceBrew range messages."
			);

			//sb.addPublish("camera_x", "range");
			//sb.addPublish("camera_y", "range");
			//sb.addPublish("button_1", "boolean");

			//sb.addPublish("slider_y", "range");

			//sb.onRangeMessage = onRangeMessage;
			sb.connect();
		};

    </script>

    <style>
      body {
        margin: 0px;
        padding: 0px;
      }
    </style>
  </head>
  <body>
    <div id="container"></div>
    <script>

      //SpaceBrew
      var sb;

      setupSpacebrew();

      function writeMessage(messageLayer, message, _x, _y) {
        var context = messageLayer.getContext();
        messageLayer.clear();
        context.font = '16pt Calibri';
        context.fillStyle = 'black';
        context.fillText(message, _x, _y);
      }

      var stage = new Kinetic.Stage({
        container: 'container',
        width: 800,
        height: 600
      });

      var shapesLayer = new Kinetic.Layer();
      var messageLayer = new Kinetic.Layer();

      var joy_1 = new obj_joystick(50,50,300,0);
      var button_0 = new obj_button(350,50,150,0);
      var button_1 = new obj_button(350,200,150,1);
      var slider_0 = new obj_slider(500,50,300,0);
      var led_0 = new obj_slider(50,350,100,0);

      var unit_size = 150;

      //joy_inside.setDraggable(true);

      joy_1.init();
/*
      button_0.init();
      button_1.init();
      slider_0.init();
      led_0.init();
*/

      stage.add(shapesLayer);

    </script>
  </body>
</html>
